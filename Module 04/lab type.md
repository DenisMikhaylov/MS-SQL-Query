Лабораторная работа: Работа с типами данных SQL Server 2016
```
Сценарий
Вы — бизнес-аналитик Adventure Works, который будет писать отчеты с использованием корпоративных баз данных,
хранящихся в SQL Server 2016. Вам был предоставлен набор бизнес-требований к данным, и вы будете писать
запросы T-SQL для извлечения указанных данных из баз данных. Вам нужно будет извлекать и преобразовывать
символьные данные, а также данные даты и времени в различные форматы.
Цели
После завершения этой лабораторной работы вы сможете:
 Писать запросы, возвращающие данные даты и времени.
 Писать запросы, использующие функции даты и времени.
 Писать запросы, возвращающие символьные данные.
 Писать запросы, использующие символьные функции.
```

Виртуальная машина: 20761C-MIA-SQL
Имя пользователя: ADVENTUREWORKS\Student
Пароль: Pa55w.rd

Упражнение 1: Написание запросов, возвращающих данные о дате и времени
```
Сценарий
Прежде чем начать использовать различные функции даты и времени в бизнес-сценариях, следует попрактиковаться на
примерах данных.
Основные задачи для этого упражнения следующие:
1. Подготовка лабораторной среды
2. Написание оператора SELECT для получения информации о текущей дате
3. Написание оператора SELECT для возврата типа данных Date
4. Написание оператора SELECT, использующего различные функции даты и времени
5. Написание оператора SELECT для демонстрации того, можно ли использовать таблицу строк в качестве дат
```
```
 Задача 1: Подготовка лабораторной среды
1. Убедитесь, что виртуальные машины 20761C-MIA-DC и 20761C-MIA-SQL
работают, а затем войдите в 20761C-MIA-SQL как ADVENTUREWORKS\Student с паролем Pa55w.rd.
2. Запустите Setup.cmd в папке D:\Labfiles\Lab06\Starter от имени администратора.

 Задание 2: Напишите оператор SELECT для получения информации о текущей дате
1. Откройте файл проекта D:\Labfiles\Lab06\Starter\Project\Project.ssmssln и скрипт T-SQL 51 -
Лабораторная работа 1.sql. Убедитесь, что вы подключены к базе данных TSQL.
2. Напишите оператор SELECT для возврата столбцов, содержащих:
o Текущую дату и время. Используйте псевдоним currentdatetime.
o Только текущую дату. Используйте псевдоним currentdate.
o Только текущее время. Используйте псевдоним currenttime.
o Только текущий год. Используйте псевдоним currentyear.
o Только номер текущего месяца. Используйте псевдоним currentmonth.
o Только номер текущего дня месяца. Используйте псевдоним currentday.
o Только номер текущей недели в году. Используйте псевдоним currentweeknumber.
o Название текущего месяца на основе столбца currentdatetime. Используйте псевдоним
currentmonthname.
3. Выполните написанное выражение и сравните полученные результаты с желаемыми результатами, показанными в
файле D:\Labfiles\Lab06\Solution\52 - Lab Exercise 1 - Task 1 Result.txt. Ваши результаты будут отличаться
из-за текущего значения даты и времени.
4. Можете ли вы использовать псевдоним currentdatetime в качестве источника во втором вычислении столбца (currentdate)?
Пожалуйста, объясните.

 Задание 3: Напишите оператор SELECT для возврата типа данных Date
Запишите 11 декабря 2015 года как столбец с типом данных date. Используйте различные возможности внутри
языка T-SQL (преобразование, преобразование, конкретная функция и т. д.) и используйте псевдоним somedate.

 Задание 4: Напишите оператор SELECT, который использует разные функции даты и времени
1. Напишите оператор SELECT, чтобы вернуть столбцы, которые содержат:
o Значение даты и времени, которое отстоит на три месяца от текущей даты и времени. Используйте псевдоним
threemonths.
o Количество дней между текущей датой и первым столбцом (threemonths). Используйте псевдоним
diffdays.
o Количество недель между 4 апреля 1992 года и 16 сентября 2011 года. Используйте псевдоним diffweeks.
o Первый день текущего месяца на основе текущей даты и времени. Используйте псевдоним firstday.
2. Выполните написанный оператор и сравните полученные результаты с желаемыми результатами,
показанными в файле D:\Labfiles\Lab06\Solution\53 - Lab Exercise 1 - Task 3 Result.txt. Некоторые результаты будут
отличаться из-за текущего значения даты и времени.

Задание 5: Напишите оператор SELECT, чтобы показать, можно ли использовать таблицу строк в качестве
дат
1. ИТ-отдел написал оператор T-SQL, который создает и заполняет таблицу с именем
Sales.Somedates.
2. Выполните предоставленный оператор T-SQL.
3. Напишите оператор SELECT для таблицы Sales.Somedates и извлеките столбец isitdate. Добавьте
новый столбец с именем converterdate с новым значением типа данных date на основе столбца isitdate. Если
столбец isitdate не может быть преобразован в тип данных date для определенной строки, верните NULL.
4. Выполните написанный оператор и сравните полученные результаты с желаемыми результатами, показанными в
файле D:\Labfiles\Lab06\Solution\54 - Lab Exercise 1 - Task 4 Result.txt.
Ответьте на следующие вопросы:
o В чем разница между функциями SYSDATETIME и CURRENT_TIMESTAMP?
o Какой формат является нейтральным по отношению к языку для типа ДАТА?
```

Упражнение 2: Написание запросов, использующих функции даты и времени

```
Сценарий
Отдел продаж хочет иметь различные отчеты, которые фокусируются на данных в течение определенных временных интервалов.
Сотрудники отдела продаж хотели бы проанализировать отдельных клиентов, отдельные продукты и заказы, размещенные ближе к концу месяца. Вам следует написать операторы SELECT, используя различные функции даты и времени.
Основные задачи для этого упражнения следующие:
1. Напишите оператор SELECT для извлечения клиентов с заказами в указанном месяце
2. Напишите оператор SELECT для вычисления первого и последнего дня месяца
3. Напишите оператор SELECT для извлечения заказов, размещенных в последние пять дней заказанного месяца
4. Напишите оператор SELECT для извлечения всех отдельных продуктов, проданных за первые 10 недель 2007 года
```
```
 Задача 1: Напишите оператор SELECT для извлечения клиентов с заказами в указанном
месяце
1. В обозревателе решений откройте скрипт T-SQL 61 - Lab Exercise 2.sql.
2. Напишите оператор SELECT для извлечения отдельных значений для столбца custid из таблицы Sales.Orders.
Отфильтруйте результаты, чтобы включить только заказы, размещенные в феврале 2008 г.
3. Выполните письменное утверждение и сравните свои результаты с желаемыми результатами, показанными в файле 62 -
Лабораторное упражнение 2 - Задача 1 Результат.txt.

 Задача 2: Напишите оператор SELECT для вычисления первого и последнего дня месяца
1. Напишите оператор SELECT со следующими столбцами:
o Текущая дата и время.
o Первая дата текущего месяца.
o Последняя дата текущего месяца.
2. Выполните письменное утверждение и сравните свои результаты с рекомендуемыми результатами, показанными в
файле D:\Labfiles\Lab06\Solution\63 - Лабораторное упражнение 2 - Задача 2 Результат.txt. Результаты будут отличаться, поскольку они основаны на текущей дате.

 Задача 3: Напишите оператор SELECT для извлечения заказов, размещенных в последние пять дней
заказанного месяца
1. Напишите оператор SELECT для таблицы Sales.Orders и извлеките столбцы orderid, custid и orderdate. Отфильтруйте результаты, чтобы включить только заказы, размещенные в последние пять дней
месяца заказа.
2. Выполните написанный оператор и сравните свои результаты с рекомендуемыми результатами, показанными в
файле D:\Labfiles\Lab06\Solution\64 - Lab Exercise 2 - Task 3 Result.txt.

 Задача 4: Напишите оператор SELECT для извлечения всех отдельных продуктов, проданных за первые 10
недель 2007 года
1. Напишите оператор SELECT для таблиц Sales.Orders и Sales.OrderDetails и извлеките все отдельные значения для столбца productid. Отфильтруйте результаты, чтобы включить только заказы, размещенные в первые 10 недель 2007 года.
2. Выполните письменное заявление и сравните свои результаты с рекомендуемыми результатами, показанными в
файле D:\Labfiles\Lab06\Solution\65 - Lab Exercise 2 - Task 4 Result.txt
```

Упражнение 3: Написание запросов, возвращающих символьные данные
```
Сценарий
Сотрудники отдела маркетинга хотели бы иметь более сжатую версию отчета для
того, когда они общаются с клиентами. Они хотят, чтобы информация, которая в настоящее время существует в двух столбцах, отображалась в
одном столбце.
Основные задачи для этого упражнения следующие:
1. Напишите оператор SELECT для объединения двух столбцов
2. Добавьте дополнительный столбец в объединенную строку, которая может содержать NULL
3. Напишите оператор SELECT для извлечения контактов клиентов на основе первого символа в имени
контакта
```
```
 Задача 1: Напишите оператор SELECT для объединения двух столбцов
1. Откройте сценарий T-SQL 71 - Лабораторная работа 3.sql и убедитесь, что вы подключены к базе данных TSQL.
2. Напишите оператор SELECT для таблицы Sales.Customers и извлеките столбцы contactname и city. Объедините оба столбца так, чтобы новый столбец выглядел следующим образом:
Аллен, Майкл (город: Берлин)
3. Выполните письменное утверждение и сравните свои результаты с рекомендуемыми результатами, показанными в
файле D:\Labfiles\Lab06\Solution\72 - Lab Exercise 3 - Task 1 Result.txt.

 Задача 2: Добавьте дополнительный столбец в объединенную строку, которая может содержать
NULL
1. Скопируйте оператор T-SQL в задаче 1 и измените его, чтобы расширить вычисляемый столбец новой
информацией из столбца региона. Для целей объединения обрабатывайте NULL в столбце региона
как пустую строку. Если регион равен NULL, измененный столбец должен выглядеть следующим образом:
Allen, Michael (город: Берлин, регион: )
Если регион не равен NULL, измененный столбец должен выглядеть следующим образом:
Richardson, Shawn (город: Сан-Паулу, регион: SP)
2. Выполните написанное утверждение и сравните свои результаты с рекомендуемыми результатами, показанными в
файле D:\Labfiles\Lab06\Solution\73 - Lab Exercise 3 - Task 2 Result.txt.

 Задача 3: Напишите оператор SELECT для извлечения контактов клиентов на основе
первого символа в имени контакта
1. Напишите оператор SELECT для извлечения столбцов contactname и contacttitle из
таблицы Sales.Customers. Верните только строки, в которых первый символ в имени контакта - от «A» до «G».
2. Выполните письменное утверждение и сравните свои результаты с рекомендуемыми результатами, показанными в
файле D:\Labfiles\Lab06\Solution\74 - Lab Exercise 3 - Task 3 Result.txt. Обратите внимание на количество возвращенных строк.
```
Упражнение 4: Написание запросов, использующих символьные функции

```
Сценарий
Отдел маркетинга хочет обращаться к клиентам по их имени и фамилии. В таблице Sales.Customers
есть только один столбец с именем contactname — оба элемента в нем разделены запятой. Вам
придется подготовить отчет, чтобы отобразить имя и фамилию отдельно.
Основные задачи для этого упражнения следующие:
1. Написать оператор SELECT, использующий функцию SUBSTRING
2. Написать запрос для извлечения имени контакта с помощью SUBSTRING
3. Написать оператор SELECT для форматирования идентификатора клиента
4. Задача: написать оператор SELECT для возврата количества вхождений символов
```
```
 Задача 1: написать оператор SELECT, использующий функцию SUBSTRING
1. Откройте скрипт T-SQL 81 — Лабораторная работа 4.sql и убедитесь, что вы подключены к базе данных TSQL.
2. Напишите оператор SELECT для извлечения столбца contactname из таблицы Sales.Customers. На основе этого столбца добавьте вычисляемый столбец с именем lastname, который должен состоять из всех символов
перед запятой.
3. Выполните написанный оператор и сравните свои результаты с рекомендуемыми результатами, показанными в
файле D:\Labfiles\Lab06\Solution\82 - Lab Exercise 4 - Task 1 Result.txt.

 Задача 2: Напишите запрос для извлечения имени контакта с помощью SUBSTRING
1. Напишите оператор SELECT для извлечения столбца contactname из таблицы Sales.Customers и
замените запятую в имени контакта пустой строкой. На основе этого столбца добавьте вычисляемый столбец с именем firstname, который должен состоять из всех символов после запятой.
2. Выполните письменное утверждение и сравните свои результаты с рекомендуемыми результатами, показанными в
файле D:\Labfiles\Lab06\Solution\83 - Lab Exercise 4 - Task 2 Result.txt.

 Задача 3: Напишите оператор SELECT для форматирования идентификатора клиента
1. Напишите оператор SELECT для извлечения столбца custid из таблицы Sales.Customers. Добавьте новый
вычисляемый столбец для создания строкового представления custid как фиксированной ширины (шесть символов)
кода клиента, с префиксом в виде буквы C и ведущими нулями. Например, значение custid 1 должно
выглядеть как C00001.
2. Выполните письменное утверждение и сравните свои результаты с рекомендуемыми результатами, показанными в
файле D:\Labfiles\Lab06\Solution\84 - Lab Exercise 4 - Task 3 Result.txt.

 Задача 4: Задача: Напишите оператор SELECT для возврата количества вхождений символа
1. Напишите оператор SELECT для извлечения столбца contactname из таблицы Sales.Customers. Добавьте
вычисляемый столбец, который должен подсчитывать количество вхождений символа «a» внутри
имени контакта. (Подсказка: используйте строковые функции REPLACE и LEN.) Упорядочите результат от наибольшего к наименьшему вхождению.
2. Выполните написанный оператор и сравните свои результаты с рекомендуемыми результатами, показанными в
файле D:\Labfiles\Lab06\Solution\85 - Lab Exercise 4 - Task 4 Result.txt.
3. Закройте SQL Server Management Studio, не сохраняя никаких файлов.
```
