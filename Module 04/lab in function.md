Лабораторная работа: использование встроенных функций
```
Сценарий
Вы бизнес-аналитик Adventure Works, который будет писать отчеты с использованием корпоративных баз данных,
хранящихся на SQL Server. Вам был предоставлен набор бизнес-требований к данным, и вы будете
писать запросы T-SQL для извлечения указанных данных из баз данных. Вам нужно будет извлечь данные,
преобразовать их, а затем проверить на наличие пропущенных значений.
Цели
После завершения этой лабораторной работы вы сможете:
 Писать запросы, включающие функции преобразования.
 Писать запросы, использующие логические функции.
 Писать запросы, проверяющие допустимость значений NULL.
```
Виртуальная машина: 20761C-MIA-SQL
Имя пользователя: ADVENTUREWORKS\Student
Пароль: Pa55w.rd

Упражнение 1: Написание запросов, использующих функции преобразования
```
Сценарий
Вам было предложено написать следующие отчеты для следующих отделов:
1. Продажи. Название продукта и цена за единицу для каждого продукта в удобной для чтения строке.
2. Маркетинг. Идентификатор заказа, дата заказа, дата доставки и регион доставки для каждого заказа после
4/1/2007.
3. ИТ. Преобразуйте всю информацию о телефонных номерах отдела продаж в целые числа.
Основные задачи для этого упражнения следующие:
1. Подготовка лабораторной среды
2. Написание оператора SELECT, использующего функцию CAST или CONVERT
3. Написание оператора SELECT для фильтрации строк на основе определенной информации о дате
4. Написание оператора SELECT для преобразования информации о телефонном номере в целочисленное значение
```
```
 Задача 1: Подготовка лабораторной среды
1. Убедитесь, что виртуальные машины 20761C-MIA-DC и 20761C-MIA-SQL запущены, а затем войдите в 20761C-MIA-SQL как ADVENTUREWORKS\Student
 с паролем Pa55w.rd.
2. Запустите Setup.cmd в папке D:\Labfiles\Lab08\Starter как администратор.

 Задача 2: Напишите оператор SELECT, использующий функцию CAST или CONVERT
1. Откройте файл проекта D:\Labfiles\Lab08\Starter\Project\Project.ssmssln и скрипт T-SQL 51 -
Лабораторная работа 1.sql. Убедитесь, что вы подключены к базе данных TSQL.
2. Напишите оператор SELECT для таблицы Production.Products, чтобы получить вычисляемый столбец с именем productdesc. Вычисляемый
 столбец должен быть основан на столбцах productname и unitprice и выглядеть следующим образом:
Результаты: цена за единицу продукта HHYDP составляет 18,00 $.
3. Выполните письменное утверждение и сравните полученные результаты с желаемыми результатами, показанными в файле
 D:\Labfiles\Lab08\Solution\52 - Lab Exercise 1 - Task 1 Result.txt.
4. Вы использовали функцию CAST или CONVERT? Какую из них, по вашему мнению, использовать более целесообразно?

 Задание 3: Напишите оператор SELECT для фильтрации строк на основе конкретной информации о дате
1. Отдел маркетинга США предоставил вам начальную дату «4/1/2007» (используя форму американского английского языка, читается
 как «1 апреля 2007 г.») и конечную дату «11/30/2007» (используя форму американского английского языка, читается как «30 ноября 2007 г.»).
2. Напишите оператор SELECT для таблицы Sales.Orders, чтобы получить столбцы orderid, orderdate, shippeddate и shipregion.
Отфильтруйте результат, чтобы включить только строки с датой заказа
между указанной начальной и конечной датой, и иметь более 30 дней между датой отправки и датой заказа. Также проверьте столбец
shipregion на наличие пропущенных значений. Если есть пропущенное значение,
то верните значение «Нет региона».
3. В этом операторе SELECT вы можете использовать функцию CONVERT с параметром стиля или функцию PARSE.
4. Выполните написанный оператор и сравните полученные результаты с желаемыми результатами,
показанными в файле D:\Labfiles\Lab08\Solution\53 - Lab Exercise 1 - Task 2 Result.txt.

 Задача 4: Напишите оператор SELECT для преобразования информации о телефонном номере в
целочисленное значение
1. ИТ-отдел хотел бы преобразовать всю информацию о телефонных номерах в
таблице Sales.Customers в целочисленные значения. Сотрудники ИТ-отдела указали, что все дефисы, скобки и
пробелы должны быть удалены перед преобразованием в целочисленный тип данных.
2. Напишите оператор SELECT для реализации требования ИТ-отдела. Замените все
указанные символы в столбце phone таблицы Sales.Customers, а затем преобразуйте столбец
из типа данных nvarchar в тип данных int. Оператор T-SQL не должен завершаться ошибкой, если
есть ошибка преобразования — он должен возвращать NULL. (Подсказка: сначала попробуйте написать оператор T-SQL с помощью
функции CONVERT, а затем сравните его с функцией TRY_CONVERT.) Используйте псевдоним phoneasint
для этого вычисляемого столбца.
3. Выполните написанный оператор и сравните полученные результаты с желаемыми результатами,
показанными в файле D:\Labfiles\Lab08\Solution\54 - Lab Exercise 3 - Task 3 Result.txt
```
Упражнение 2: Написание запросов, использующих логические функции

```
Сценарий
Отдел продаж хотел бы иметь разные отчеты относительно сегментации клиентов и
определенных строк заказов. Вы добавите новый вычисляемый столбец, чтобы показать целевую группу для сегментации.
Основные задачи для этого упражнения следующие:
1. Напишите оператор SELECT, чтобы отметить определенных клиентов на основе их страны и должности контакта
2. Измените оператор T-SQL, чтобы отметить разных клиентов
3. Создайте четыре группы клиентов
```
```
 Задача 1: Напишите оператор SELECT, чтобы отметить определенных клиентов на основе их
страны и должности контакта
1. Откройте скрипт T-SQL 61 - Лабораторная работа 2.sql. Убедитесь, что вы подключены к базе данных TSQL.
2. Напишите оператор SELECT для таблицы Sales.Customers и извлеките столбцы custid и
contactname. Добавьте вычисляемый столбец с именем segmentgroup, используя логическую функцию IIF
со значением «Целевая группа» для клиентов из Мексики, имеющих значение «Владелец» в
заголовке контакта. Используйте значение «Другое» для остальных клиентов.
3. Выполните письменное утверждение и сравните полученные результаты с желаемыми результатами,
показанными в файле D:\Labfiles\Lab08\Solution\62 - Lab Exercise 2 - Task 1 Result.txt.

 Задача 2: изменение оператора T-SQL для обозначения разных клиентов
1. Измените оператор T-SQL из задачи 1, чтобы изменить вычисляемый столбец для отображения значения «Целевая
группа» для всех клиентов без пропущенного значения в атрибуте региона или со значением «Владелец» в
атрибуте заголовка контакта.
2. Выполните письменное утверждение и сравните полученные результаты с рекомендуемым результатом, показанным в файле D:\Labfiles\Lab08\Solution\63 - Lab Exercise 2 - Task 2 Result.txt.

 Задача 3: Создайте четыре группы клиентов
1. Напишите оператор SELECT для таблицы Sales.Customers и извлеките столбцы custid и
contactname. Добавьте вычисляемый столбец с именем segmentgroup, используя логическую функцию
CHOOSE с четырьмя возможными описаниями («Group One», «Group Two», «Group Three», «Group
Four»). Используйте оператор modulo для столбца custid. (Используйте выражение custid % 4 + 1 для определения целевой группы.)
2. Выполните письменное утверждение и сравните полученные вами результаты с рекомендуемыми результатами, показанными в файле
 D:\Labfiles\Lab08\Solution\64 - Lab Exercise 2 - Task 3 Result.txt.
```
