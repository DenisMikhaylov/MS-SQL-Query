Лаборатория: Использование подзапросов
```
СценарийВы работаете бизнес-аналитиком в компании Adventure Works и создаете отчёты, используя корпоративные базы данных, хранящиеся в SQL Server. Вам предоставлены требования бизнеса относительно необходимой информации, и вам предстоит написать запросы на T-SQL для извлечения указанных данных из баз данных. Из-за сложности некоторых запросов вам потребуется внедрять подзапросы в ваши запросы, чтобы возвращать результаты одним запросом.

ЦелиПо завершении этой лаборатории вы сможете:

Писать запросы, использующие подзапросы.
Писать запросы, использующие скалярные и многострочные подзапросы.
Писать запросы, использующие коррелированные подзапросы и предикат EXISTS.
Примерное время: 60 минут

Виртуальная машина: 20761C-MIA-SQL

Имя пользователя: AdventureWorks\Student

Пароль: Pa55w.rd
```
Упражнение 1: Написание запросов, использующих автономные подзапросы
```
СценарийОтдел продаж нуждается в продвинутых отчетах для анализа заказов. Вы будете писать разные операторы SELECT, использующие автономные подзапросы.

Основные задачи этого упражнения включают следующее:

Подготовьте лабораторную среду.
Напишите оператор SELECT для получения последней даты заказа.
Напишите оператор SELECT для выборки всех заказов, размещенных на последнюю дату заказа.
Ознакомьтесь с оператором T-SQL, предоставленным ИТ-отделом.
Напишите оператор SELECT для анализа каждой продажи как процента от общей суммы продаж.
```
```
✔️ Задача 1: Подготовка лабораторной среды

Убедитесь, что виртуальные машины 20761C-MIA-DC и 20761C-MIA-SQL запущены, затем войдите в систему на машине 20761C-MIA-SQL как ADVENTUREWORKS\Student с паролем Pa55w.rd.
Запустите файл Setup.cmd в папке D:\Labfiles\Lab10\Starter от имени администратора.
✔️ Задача 2: Написание оператора SELECT для получения последней даты заказа

Откройте проект-файл D:\Labfiles\Lab10\Starter\Project\Project.ssmssln и скрипт T-SQL 51-Lab Exercise 1.sql. Убедитесь, что вы подключены к базе данных TSQL.
Напишите оператор SELECT для возврата максимальной даты заказа из таблицы Sales.Orders.
Выполните написанный вами оператор и сравните полученные результаты с требуемыми результатами, показанными в файле D:\Labfiles\Lab10\Solution\52 - Lab Exercise 1 - Task 1 Result.txt

Задача 3: Написание оператора SELECT для получения всех заказов, сделанных на последнюю дату заказа

Напишите оператор SELECT для возвращения столбцов orderid, orderdate, empid и custid из таблицы Sales.Orders. Отфильтруйте результаты таким образом, чтобы включить только заказы, дата которых равна последней дате заказа. (Подсказка: используйте запрос из задания 1 в качестве автономного подзапроса.)
Выполните написанный вами оператор и сравните полученные результаты с требуемыми результатами, указанными в файле D:\Labfiles\Lab10\Solution\53 - Lab Exercise 1 - Task 2 Result.txt.
✔️ Задача 4: Просмотр оператора T-SQL, предоставленного отделом ИТ

Отдел ИТ написал оператор T-SQL, извлекающий заказы всех клиентов, чьё контактное лицо начинается с буквы 'I':

SELECT
   orderid, orderdate, empid, custid
FROM Sales.Orders
WHERE
   custid = (
      SELECT custid
      FROM Sales.Customers
      WHERE contactname LIKE N'I%'
   );
Выполните этот запрос и посмотрите на результат.
Измените запрос так, чтобы фильтровать клиентов, чьё контактное лицо начинается с буквы 'B'.
Выполните запрос. Что произошло? Какое сообщение об ошибке появилось? Почему запрос завершился неудачей?
Примените необходимые изменения к оператору T-SQL, чтобы он выполнялся без ошибок.
Выполните исправленный оператор и сравните полученные результаты с требуемыми результатами, указанными в файле D:\Labfiles\Lab10\Solution\54 - Lab Exercise 1 - Task 3 Result.txt.
✔️ Задача 5: Написание оператора SELECT для анализа каждого заказа как процентной доли от общей суммы продаж

Напишите оператор SELECT для возвращения столбца orderid из таблицы Sales.Orders и следующих вычисляемых столбцов:
totalsalesamount (основан на значениях столбцов qty и unitprice в таблице Sales.OrderDetails).
salespctoftotal (процент общей суммы продаж для каждого заказа, поделённый на общую сумму продаж за определённый период).
Фильтруйте результаты, включая только заказы, сделанные в мае 2008 года.
Выполните написанный вами оператор и сравните полученные результаты с требуемыми результатами, указанными в файле D:\Labfiles\Lab10\Solution\55 - Lab Exercise 1 - Task 4 Result.txt.
```
