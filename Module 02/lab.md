Лабораторная работа: написание базовых операторов SELECT

Упражнение 1: написание простых операторов SELECT
```
Задача 1: подготовка лабораторной среды
Убедитесь, что виртуальные машины MT17B-WS2016-NAT, 20761C-MIA-DC и 20761C-MIA-SQL обе запущены, а затем войдите в 20761C-MIA-SQL как ADVENTUREWORKS\Student с паролем
Pa55w.rd.
1. В папке D:\Labfiles\Lab03\Starter щелкните правой кнопкой мыши Setup.cmd и выберите Запуск от имени
администратора.
2. В диалоговом окне «Контроль учетных записей пользователей» щелкните Да.
3. После завершения скрипта нажмите Enter.

Задача 2: просмотр всех таблиц в базе данных ADVENTUREWORKS в обозревателе объектов
1. На панели задач щелкните Microsoft SQL Server Management Studio.
2. В диалоговом окне «Подключение к серверу» в поле «Имя сервера» введите MIA-SQL и нажмите
Параметры.
3. В разделе «Свойства подключения» в списке «Подключение к базе данных» нажмите <Обзор сервера>.
4. В диалоговом окне «Обзор баз данных» нажмите Да.
5. В диалоговом окне «Обзор серверов баз данных» в разделе «Пользовательские базы данных» нажмите TSQL и нажмите
ОК.
6. В диалоговом окне «Подключение к серверу» на вкладке «Вход» в списке «Аутентификация» нажмите «Аутентификация Windows» и нажмите
Подключиться.
7. В обозревателе объектов в разделе MIA-SQL разверните «Базы данных», разверните TSQL и разверните «Таблицы».
8. В разделе Таблицы обратите внимание, что в схеме Sales есть четыре объекта таблиц:
 Sales.Customers
 Sales.OrderDetails
 Sales.Orders
 Sales.Shippers

Задача 3: Напишите простой оператор SELECT, который возвращает все строки и столбцы из
таблицы
1. В меню Файл выберите Открыть, а затем щелкните Проект/Решение.
2. В диалоговом окне Открыть проект перейдите в папку D:\Labfiles\Lab03\Starter\Project, а затем дважды щелкните Project.ssmssln.
3. В обозревателе решений разверните Запросы, а затем дважды щелкните Лабораторное упражнение 1.sql.
4. В окне запроса выделите оператор USE TSQL;, а затем щелкните Выполнить.
5. На панели запросов после описания задания 2 введите следующий запрос:
SELECT *
FROM Sales.Customers;
6. Выделите введенный вами запрос и нажмите «Выполнить».
7. На панели запросов введите следующий код после первого запроса:
SELECT *
FROM
8. В обозревателе объектов в разделе MIA-SQL, в разделе Базы данных, в разделе TSQL, в разделе Таблицы нажмите
Sales.Customers.
9. Перетащите выбранную таблицу на панель запросов после предложения FROM. Добавьте точку с запятой в конец оператора SELECT. Ваш готовый запрос должен выглядеть следующим образом:
SELECT *
FROM [Sales].[Customers];
10. Выделите написанный запрос и нажмите «Выполнить».


Задача 4: Напишите оператор SELECT, возвращающий определенные столбцы
1. В обозревателе объектов разверните Sales.Customers, разверните Columns и просмотрите все столбцы в таблице Sales.Customers.
2. На панели запросов после описания задачи 3 введите следующий запрос:
SELECT contactname, address, postalcode, city, country
FROM Sales.Customers;
3. Выделите написанный запрос и нажмите Execute.
4. Просмотрите результат. Сколько строк затронуто последним запросом? Есть несколько способов ответить на этот вопрос с помощью SQL Server Management Studio. Один из способов — выбрать предыдущий запрос и нажать Execute. Общее количество строк, затронутых выполненным запросом, записано на панели Results на вкладке Messages:
(затронута 91 строка(и))
Другой способ — посмотреть на строку состояния, отображаемую под панелью Results. С левой стороны строки состояния отображается сообщение: «Запрос выполнен успешно». С правой стороны отображается общее количество строк, затронутых текущим запросом (91 строка).
Результаты: После этого упражнения вы должны знать, как создавать простые операторы SELECT для анализа существующих
таблиц.
```
Упражнение 2: Устранение дубликатов с помощью DISTINCT
```
 Задание 1: Напишите оператор SELECT, включающий определенный столбец
1. В обозревателе решений дважды щелкните Lab Exercise 2.sql.
2. В окне запроса выделите оператор USE TSQL; и нажмите кнопку Execute.
3. На панели запроса после описания задания 1 введите следующий запрос:
SELECT country
FROM Sales.Customers;
4. Выделите написанный запрос и нажмите кнопку Execute.
5. Обратите внимание, что у вас есть несколько строк с одинаковыми значениями. Это происходит потому, что таблица Sales.Customers
имеет несколько строк с одинаковым значением для столбца страны.

 Задача 2: Напишите оператор SELECT, который использует предложение DISTINCT
1. Выделите предыдущий запрос, а затем в меню Edit нажмите Copy.
2. В окне запроса щелкните строку после описания Task 2.
3. В меню Edit нажмите Paste. Теперь вы скопировали предыдущий запрос в то же окно запроса
после описания task 2.
4. Измените запрос, введя DISTINCT после предложения SELECT. Ваш запрос должен выглядеть следующим образом:
SELECT DISTINCT country
FROM Sales.Customers;
5. Выделите написанный запрос и нажмите Execute.
   6. Посмотрите на результат и ответьте на следующие вопросы:
Сколько строк вернул запрос в задаче 1?
Чтобы ответить на этот вопрос, вы можете выделить запрос, написанный под описанием задачи 1, нажать «Выполнить» и прочитать панель «Результаты». (Если вы забыли, как получить доступ к этой панели, посмотрите на задачу 4 в упражнении 1.) Количество строк, затронутых запросом, равно 91.
Сколько строк вернул запрос в задаче 2?
Чтобы ответить на этот вопрос, вы можете выделить запрос, написанный под описанием задачи 2, нажать «Выполнить» и прочитать панель «Результаты». Количество строк, затронутых запросом, равно 21. Это означает, что для столбца страны в таблице Sales.Customers имеется
21 различных значений.
При каких обстоятельствах следующие запросы к таблице Sales.Customers возвращают
одинаковый результат?
ВЫБРАТЬ город, регион ИЗ Sales.Customers;
SELECT DISTINCT city, region FROM Sales.Customers;
Если все комбинации значений в столбцах city и region в таблице Sales.Customers уникальны,
оба запроса вернут одинаковое количество строк. Если они не уникальны, первый запрос вернет больше строк, чем второй с предложением DISTINCT.
Применяется ли предложение DISTINCT ко всем столбцам, указанным в запросе, или только к первому столбцу?
Предложение DISTINCT всегда применяется ко всем столбцам, указанным в списке SELECT. Очень важно
помнить, что предложение DISTINCT применяется не только к первому столбцу в списке.

Результаты: После этого упражнения вы должны понимать, как возвращать только разные (отдельные) строки в
результате запроса.
```
Упражнение 3: использование псевдонимов таблиц и столбцов
```
 Задача 1: напишите оператор SELECT, использующий псевдоним таблицы
1. В обозревателе решений дважды щелкните Lab Exercise 3.sql.
2. В окне запроса выделите оператор USE TSQL; и нажмите Execute.
3. На панели запроса после описания Task 1 введите следующий запрос:
SELECT c.contactname, c.contacttitle
FROM Sales.Customers AS c;
Совет: чтобы использовать функцию IntelliSense при вводе имен столбцов в операторе SELECT, можно использовать сочетания клавиш. Чтобы включить IntelliSense, нажмите Ctrl+Q+I. Чтобы вывести список всех членов псевдонима, поместите указатель после псевдонима и точки (например, после «c.») и нажмите Ctrl+J.
4. Выделите написанный запрос и нажмите Execute.

 Задача 2: Напишите оператор SELECT, который использует псевдонимы столбцов
1. В панели запросов после описания задачи 2 введите следующий запрос:
SELECT c.contactname AS Name, c.contacttitle AS Title, c.companyname AS [Company
Name]
FROM Sales.Customers AS c;
Обратите внимание, что псевдоним столбца [Company Name] заключен в квадратные скобки. Имена столбцов и псевдонимы со встроенными пробелами или зарезервированными ключевыми словами должны быть разделены. В этом примере в качестве разделителя используются квадратные скобки, но вы также можете использовать стандартный разделитель ANSI SQL — двойные кавычки, как в «Company Name».
2. Выделите написанный запрос и нажмите «Выполнить».

 Задача 3: Напишите оператор SELECT, который использует псевдонимы таблиц и столбцов
1. В панели запросов после описания задачи 3 введите следующий запрос:
SELECT p.productname AS [Product Name]
FROM Production.Products AS p;
2. Выделите написанный запрос и нажмите «Выполнить».
 Задача 4: Проанализируйте и исправьте запрос
1. Выделите написанный запрос под описанием задачи 4 и нажмите «Выполнить».
2. Посмотрите на результат. Обратите внимание, что извлекается только один столбец. Проблема в том, что разработчик забыл
добавить запятую после первого имени столбца, поэтому SQL Server обработал второе слово после первого
имени столбца как псевдоним. По этой причине лучше всего всегда использовать AS при указании псевдонимов — тогда такие ошибки легче обнаружить. 
3. Исправьте запрос, добавив запятую после имени первого столбца. Исправленный запрос должен выглядеть следующим образом:
SELECT city, country
FROM Sales.Customers;
Результаты: После этого упражнения вы будете знать, как использовать псевдонимы для имен таблиц и столбцов.
```
Упражнение 4: Использование простого выражения CASE
```
 Задание 1: Напишите оператор SELECT
1. В обозревателе решений дважды щелкните Lab Exercise 4.sql.
2. В окне запроса выделите оператор USE TSQL; и нажмите кнопку Execute.
3. На панели запроса после описания задания 1 введите следующий запрос:
SELECT p.categoryid, p.productname
FROM Production.Products AS p;
4. Выделите написанный запрос и нажмите кнопку Execute.

Задача 2: Напишите оператор SELECT, который использует выражение CASE
1. В панели запроса после описания задачи 2 введите следующее:
SELECT p.categoryid, p.productname,
CASE
WHEN p.categoryid = 1 THEN 'Напитки'
WHEN p.categoryid = 2 THEN 'Приправы'
WHEN p.categoryid = 3 THEN 'Кондитерские изделия'
WHEN p.categoryid = 4 THEN 'Молочные продукты'
WHEN p.categoryid = 5 THEN 'Зерна/Крупы'
WHEN p.categoryid = 6 THEN 'Мясо/Птица'
WHEN p.categoryid = 7 THEN 'Продукты'
WHEN p.categoryid = 8 THEN 'Морепродукты'
ELSE 'Другое'
END AS categoryname
FROM Production.Products AS p;
Этот запрос использует выражение CASE для добавления нового столбца

Задание 3: Напишите оператор SELECT, который использует выражение CASE для дифференциации
Продуктов, ориентированных на кампанию
1. Выделите предыдущий запрос, а затем в меню «Правка» нажмите «Копировать».
2. В окне запроса нажмите строку после описания задания 3.
3. В меню «Правка» нажмите «Вставить». Теперь вы скопировали предыдущий запрос в то же окно запроса
после описания задания 3. 
4. Добавьте новый столбец, используя дополнительное выражение CASE. Ваш запрос должен выглядеть следующим образом:
SELECT p.categoryid, p.productname,
CASE
WHEN p.categoryid = 1 THEN 'Напитки'
WHEN p.categoryid = 2 THEN 'Приправы'
WHEN p.categoryid = 3 THEN 'Кондитерские изделия'
WHEN p.categoryid = 4 THEN 'Молочные продукты'
WHEN p.categoryid = 5 THEN 'Зерна/Крупы'
WHEN p.categoryid = 6 THEN 'Мясо/Птица'
WHEN p.categoryid = 7 THEN 'Продукты'
WHEN p.categoryid = 8 THEN 'Морепродукты'
ELSE 'Другое'
END AS categoryname,
CASE
WHEN p.categoryid IN (1, 7, 8) THEN 'Продукты кампании'
ELSE 'Non-Campaign Products'
END AS iscampaign
FROM Production.Products AS p;
5. Выделите написанный запрос и нажмите Выполнить.
6. В результате обратите внимание, что первое выражение CASE использует простую форму, тогда как второе использует искомую форму.
```
