## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 1: –ù–∞–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è

### üìå –°—Ü–µ–Ω–∞—Ä–∏–π
–û—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂ —Ö–æ—á–µ—Ç –≤–∏–¥–µ—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ –∑–∞–∫–∞–∑–æ–≤ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞. –í—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ –æ—Ç—á–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é RANK. –¢–∞–∫–∂–µ –≤—ã –Ω–∞—É—á–∏—Ç–µ—Å—å –¥–æ–±–∞–≤–ª—è—Ç—å —Ä–∞—Å—á–µ—Ç–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫–∏ –ø—Ä—è–º–æ –≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–µ SELECT.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏:
1. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—É—é —Å—Ä–µ–¥—É.
2. –ù–∞–ø–∏—Å–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏—é ROW_NUMBER –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞—Å—á—ë—Ç–Ω–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞.
3. –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ RANK.
4. –ù–∞–ø–∏—Å–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Ä–∞–Ω–≥–∞, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ –∫–ª–∏–µ–Ω—Ç—É –∏ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ–≥–æ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞.
5. –ù–∞–ø–∏—Å–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∑–∞–∫–∞–∑–æ–≤, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º –∏ –≥–æ–¥—É –∑–∞–∫–∞–∑–∞, –∏ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ–≥–æ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞.
6. –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã —Å –¥–≤—É–º—è –≤—ã—Å—à–∏–º–∏ —Ä–∞–Ω–≥–∞–º–∏.

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Å—Ä–µ–¥—ã
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–±–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã 20761C-MIA-DC –∏ 20761C-MIA-SQL –∑–∞–ø—É—â–µ–Ω—ã. –í–æ–π–¥–∏—Ç–µ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä 20761C-MIA-SQL –ø–æ–¥ —É—á—ë—Ç–Ω–æ–π –∑–∞–ø–∏—Å—å—é ADVENTUREWORKS\Student —Å –ø–∞—Ä–æ–ª–µ–º Pa55w.rd.

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª Setup.cmd –≤ –ø–∞–ø–∫–µ D:\Labfiles\Lab13\Starter –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 2: –ù–∞–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ SELECT —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ ROW_NUMBER –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞—Å—á–µ—Ç–Ω–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞
1. –í SQL Server Management Studio –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç-—Ñ–∞–π–ª D:\Labfiles\Lab13\Starter\Project\Project.ssmssln –∏ —Å–∫—Ä–∏–ø—Ç T-SQL 51-Lab Exercise 1.sql. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö TSQL.

2. –ù–∞–ø–∏—à–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ `orderid`, `orderdate` –∏ `val` –∏–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è `Sales.OrderValues`, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–≤ —Ä–∞—Å—á–µ—Ç–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü `rowno` —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ ROW_NUMBER(). –°—Ç–æ–ª–±–µ—Ü `rowno` –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ —Å—Ç–æ–ª–±—Ü—É `orderdate`.

```sql
SELECT orderid, orderdate, val,
       ROW_NUMBER() OVER (ORDER BY orderdate) AS rowno
FROM Sales.OrderValues;
```

3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –∂–µ–ª–∞–µ–º—ã–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –≤ —Ñ–∞–π–ª–µ `D:\Labfiles\Lab13\Solution\52 - Lab Exercise 1 - Task 1 Result.txt`.

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ RANK
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ –µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –µ—â—ë –æ–¥–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–Ω–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ `rankno`, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é RANK(), –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–æ —Å—Ç–æ–ª–±—Ü—É `orderdate`.

```sql
SELECT orderid, orderdate, val,
       ROW_NUMBER() OVER (ORDER BY orderdate) AS rowno,
       RANK() OVER (ORDER BY orderdate) AS rankno
FROM Sales.OrderValues;
```

2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –∂–µ–ª–∞–µ–º—ã–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –≤ —Ñ–∞–π–ª–µ `D:\Labfiles\Lab13\Solution\53 - Lab Exercise 1 - Task 2 Result.txt`. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑–ª–∏—á–∏—è –≤ –∑–Ω–∞—á–µ–Ω–∏—è—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ `rowno` –∏ `rankno` –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ç—Ä–æ–∫.

3. –í —á—ë–º –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ –º–µ–∂–¥—É —Ñ—É–Ω–∫—Ü–∏—è–º–∏ RANK –∏ ROW_NUMBER?

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 4: –ù–∞–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ SELECT –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Ä–∞–Ω–≥–∞, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ –∫–ª–∏–µ–Ω—Ç—É –∏ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ–≥–æ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞
1. –ù–∞–ø–∏—à–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ `orderid`, `orderdate`, `custid` –∏ `val` –∏–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è `Sales.OrderValues`, —Ç–∞–∫–∂–µ —Å–æ–∑–¥–∞–≤–∞—è —Ä–∞—Å—á–µ—Ç–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü `orderrankno`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ –∑–∞–∫–∞–∑–æ–≤ –ø–æ –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞, —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞ (`val`).

```sql
SELECT orderid, orderdate, custid, val,
       RANK() OVER (PARTITION BY custid ORDER BY val DESC) AS orderrankno
FROM Sales.OrderValues;
```

2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –∂–µ–ª–∞–µ–º—ã–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –≤ —Ñ–∞–π–ª–µ `D:\Labfiles\Lab13\Solution\54 - Lab Exercise 1 - Task 3 Result.txt`.

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 5: –ù–∞–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ SELECT –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∑–∞–∫–∞–∑–æ–≤, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º –∏ –≥–æ–¥—É –∑–∞–∫–∞–∑–∞, –∏ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ–≥–æ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞
1. –ù–∞–ø–∏—à–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ `custid` –∏ `val` –∏–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è `Sales.OrderValues`, –¥–æ–±–∞–≤–∏–≤ –¥–≤–∞ —Ä–∞—Å—á–µ—Ç–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–∞:
- `orderyear`: –≥–æ–¥ –∑–∞–∫–∞–∑–∞, –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–π –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ `orderdate`.
- `orderrankno`: —Ä–∞–Ω–≥ —á–∏—Å–ª–∞, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ –ø–æ–∫—É–ø–∞—Ç–µ–ª—é –∏ –≥–æ–¥—É –∑–∞–∫–∞–∑–∞, –∏ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞.

```sql
SELECT custid, val,
       YEAR(orderdate) AS orderyear,
       RANK() OVER (PARTITION BY custid, YEAR(orderdate) ORDER BY val DESC) AS orderrankno
FROM Sales.OrderValues;
```

2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –∂–µ–ª–∞–µ–º—ã–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –≤ —Ñ–∞–π–ª–µ `D:\Labfiles\Lab13\Solution\55 - Lab Exercise 1 - Task 4 Result.txt`.

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 6: –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã —Å –ø–µ—Ä–≤—ã–º–∏ –¥–≤—É–º—è —Ä–∞–Ω–≥–∞–º–∏
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT –∏ –∏–∑–º–µ–Ω–∏—Ç–µ –µ–≥–æ, –æ—Å—Ç–∞–≤–∏–≤ —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã —Å –ø–µ—Ä–≤—ã–º –∏ –≤—Ç–æ—Ä—ã–º —Ä–∞–Ω–≥–æ–º –ø–æ —Å—Ç–æ–ª–±—Ü—É `orderrankno`.

```sql
SELECT custid, val,
       YEAR(orderdate) AS orderyear,
       RANK() OVER (PARTITION BY custid, YEAR(orderdate) ORDER BY val DESC) AS orderrankno
FROM Sales.OrderValues
WHERE RANK() OVER (PARTITION BY custid, YEAR(orderdate) ORDER BY val DESC) <= 2;
```

2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –∂–µ–ª–∞–µ–º—ã–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –≤ —Ñ–∞–π–ª–µ `D:\Labfiles\Lab13\Solution\56 - Lab Exercise 1 - Task 5 Result.txt`.

3. ## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 2: –ù–∞–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–º–µ—â–∞—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π (Offset Functions)

### üìå –°—Ü–µ–Ω–∞—Ä–∏–π
–í–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É —Å–æ—Å–µ–¥–Ω–∏–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—Å—Ç –∏ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏:
1. –ù–∞–ø–∏—Å–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–æ–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ–±—â–µ–π —Ç–∞–±–ª–∏—á–Ω–æ–π –≤—ã—Ä–∞–∂–µ–Ω–∏—è (Common Table Expression, CTE).
2. –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–æ–ª–±–µ—Ü –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—â–µ–≥–æ –æ–±—ä—ë–º–∞ –ø—Ä–æ–¥–∞–∂ –Ω–∞—Ä–∞—Å—Ç–∞—é—â–∏–º –∏—Ç–æ–≥–æ–º.
3. –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–¥–∞–∂–∞—Ö –∑–∞ 2007 –≥–æ–¥.

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 1: –ù–∞–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ SELECT –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–æ–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º CTE
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∫—Ä–∏–ø—Ç T-SQL 71-Lab Exercise 3.sql. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö TSQL.

2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ CTE —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º `OrderRows`, –∫–æ—Ç–æ—Ä–æ–µ –æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –∑–∞–ø—Ä–æ—Å–µ, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–µ–º —Å—Ç–æ–ª–±—Ü—ã `orderid`, `orderdate` –∏ `val` –∏–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è `Sales.OrderValues`. –î–æ–±–∞–≤—å—Ç–µ —Ä–∞—Å—á–µ—Ç–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü `rowno`, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é `ROW_NUMBER()` –∏ —Å–æ—Ä—Ç–∏—Ä—É—è –ø–æ —Å—Ç–æ–ª–±—Ü–∞–º `orderdate` –∏ `orderid`.

```sql
WITH OrderRows AS (
    SELECT orderid, orderdate, val,
           ROW_NUMBER() OVER (ORDER BY orderdate, orderid) AS rowno
    FROM Sales.OrderValues
)
SELECT cr.orderid, cr.orderdate, cr.val, pr.val AS prevval,
       cr.val - COALESCE(pr.val, 0) AS diffprev
FROM OrderRows AS cr
LEFT JOIN OrderRows AS pr ON cr.rowno = pr.rowno + 1;
```

3. –ù–∞–ø–∏—à–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT –ø—Ä–æ—Ç–∏–≤ CTE –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–µ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (LEFT JOIN) —Å —Ç–æ–π –∂–µ —Å–∞–º–æ–π CTE –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–æ–∫–∏ –∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —Å—Ç–æ–ª–±—Ü–∞ `rowno`. –í–µ—Ä–Ω–∏—Ç–µ —Å—Ç–æ–ª–±—Ü—ã `orderid`, `orderdate` –∏ `val` –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–æ–∫–∏ –∏ —Å—Ç–æ–ª–±–µ—Ü `val` –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç—Ä–æ–∫–∏ –∫–∞–∫ `prevval`. –î–æ–±–∞–≤—å—Ç–µ —Ä–∞—Å—á–µ—Ç–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü `diffprev`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∂–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É —Ç–µ–∫—É—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º `val` –∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º `val`.

4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–¥ T-SQL –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –≤ —Ñ–∞–π–ª–µ `D:\Labfiles\Lab13\Solution\62 - Lab Exercise 2 - Task 1 Result.txt`.

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—â–µ–≥–æ –æ–±—ä–µ–º–∞ –ø—Ä–æ–¥–∞–∂ –Ω–∞—Ä–∞—Å—Ç–∞—é—â–∏–º –∏—Ç–æ–≥–æ–º
1. –ù–∞–ø–∏—à–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é `LAG()` –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∑–∞–¥–∞—á–µ. –ó–∞–ø—Ä–æ—Å –Ω–µ –¥–æ–ª–∂–µ–Ω –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å CTE.

```sql
SELECT orderid, orderdate, val,
       LAG(val) OVER (ORDER BY orderdate, orderid) AS prevval,
       val - COALESCE(LAG(val) OVER (ORDER BY orderdate, orderid), 0) AS diffprev
FROM Sales.OrderValues;
```

2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –≤ —Ñ–∞–π–ª–µ `D:\Labfiles\Lab13\Solution\63 - Lab Exercise 2 - Task 2 Result.txt`.

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 3: –ê–Ω–∞–ª–∏–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–¥–∞–∂–∞—Ö –∑–∞ 2007 –≥–æ–¥
1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ CTE —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º `SalesMonth2007`, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–∑–¥–∞–µ—Ç –¥–≤–∞ —Å—Ç–æ–ª–±—Ü–∞: `monthno` (–Ω–æ–º–µ—Ä –º–µ—Å—è—Ü–∞ –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ `orderdate`) –∏ `val` (—Å—É–º–º–∞—Ä–Ω—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å `val`). –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–¥–æ–º 2007 –∏ —Å–≥—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ –∏—Ö –ø–æ –º–µ—Å—è—Ü—É.

```sql
WITH SalesMonth2007 AS (
    SELECT MONTH(orderdate) AS monthno, SUM(val) AS val
    FROM Sales.OrderValues
    WHERE YEAR(orderdate) = 2007
    GROUP BY MONTH(orderdate)
)
SELECT monthno, val,
       AVG(LAG(val, 1) OVER (ORDER BY monthno)) +
       AVG(LAG(val, 2) OVER (ORDER BY monthno)) +
       AVG(LAG(val, 3) OVER (ORDER BY monthno)) / 3 AS avglast3months,
       SUM(val) OVER (ORDER BY monthno ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ytdval
FROM SalesMonth2007;
```

2. –ù–∞–ø–∏—à–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ `monthno` –∏ `val`. –î–æ–±–∞–≤—å—Ç–µ –¥–≤–∞ —Ä–∞—Å—á–µ—Ç–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–∞:
- `avglast3months`: —Å—Ä–µ–¥–Ω–∏–π –æ–±—ä–µ–º –ø—Ä–æ–¥–∞–∂ –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ç—Ä–∏ –º–µ—Å—è—Ü–∞ –ø–µ—Ä–µ–¥ —Ç–µ–∫—É—â–∏–º –º–µ—Å—è—Ü–µ–º, –∏—Å–ø–æ–ª—å–∑—É—è –æ–∫–æ–Ω–Ω—É—é –∞–≥—Ä–µ–≥–∞—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é. –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–æ–ø—É—Å–∫–∏ –º–µ—Å—è—Ü–µ–≤.
- `ytdval`: –∫—É–º—É–ª—è—Ç–∏–≤–Ω—ã–π –æ–±—ä–µ–º –ø—Ä–æ–¥–∞–∂ –Ω–∞—Ä–∞—Å—Ç–∞—é—â–∏–º –∏—Ç–æ–≥–æ–º –¥–æ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞.

3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –≤ —Ñ–∞–π–ª–µ `D:\Labfiles\Lab13\Solution\63 - Lab Exercise 2 - Task 3 Result.txt`.

4. ## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 3: –ù–∞–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ–∫–æ–Ω–Ω—ã—Ö –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

### üìå –°—Ü–µ–Ω–∞—Ä–∏–π
–î–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –¥–∏–Ω–∞–º–∏–∫–∏ –æ–±—â–∏—Ö –æ–±—ä–µ–º–æ–≤ –ø—Ä–æ–¥–∞–∂ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞–º –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –Ω–∞—Ä–∞—Å—Ç–∞—é—â–µ–≥–æ –∏—Ç–æ–≥–∞ (year-to-date), –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã SELECT, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –æ–∫–æ–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏:
1. –ù–∞–ø–∏—Å–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–∫–ª–∞–¥–∞ –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –æ–±—â–µ–º—É –æ–±—ä–µ–º—É –∑–∞–∫—É–ø–æ–∫ –∫–ª–∏–µ–Ω—Ç–∞.
2. –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–æ–ª–±–µ—Ü –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—â–µ–π —Å—É–º–º—ã –ø—Ä–æ–¥–∞–∂ –Ω–∞—Ä–∞—Å—Ç–∞—é—â–∏–º –∏—Ç–æ–≥–æ–º.
3. –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑ –æ–±—â–µ–π —Å—É–º–º—ã –ø—Ä–æ–¥–∞–∂ –Ω–∞—Ä–∞—Å—Ç–∞—é—â–∏–º –∏—Ç–æ–≥–æ–º –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –æ–±—ä–µ–º–∞ –ø—Ä–æ–¥–∞–∂ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∏ –º–µ—Å—è—Ü–∞.

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 1: –ù–∞–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ SELECT –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–∫–ª–∞–¥–∞ –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –æ–±—â–∏–º –æ–±—ä–µ–º–æ–º –µ–≥–æ –∑–∞–∫—É–ø–æ–∫
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∫—Ä–∏–ø—Ç T-SQL 71-Lab Exercise 3.sql. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö TSQL.

2. –ù–∞–ø–∏—à–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ `custid`, `orderid`, `orderdate` –∏ `val` –∏–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è `Sales.OrderValues`. –î–æ–±–∞–≤—å—Ç–µ —Ä–∞—Å—á–µ—Ç–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü `percoftotalcust`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –æ–±—â–µ–π —Å—É–º–º–µ –∑–∞–∫—É–ø–æ–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞.

```sql
SELECT custid, orderid, orderdate, val,
       val * 100.0 /
       SUM(val) OVER (PARTITION BY custid) AS percoftotalcust
FROM Sales.OrderValues;
```

3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –≤ —Ñ–∞–π–ª–µ `D:\Labfiles\Lab13\Solution\72 - Lab Exercise 3 - Task 1 Result.txt`.

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—â–µ–π —Å—É–º–º—ã –ø—Ä–æ–¥–∞–∂ –Ω–∞—Ä–∞—Å—Ç–∞—é—â–∏–º –∏—Ç–æ–≥–æ–º
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT –∏ –∏–∑–º–µ–Ω–∏—Ç–µ –µ–≥–æ, –¥–æ–±–∞–≤–∏–≤ –Ω–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü `runval`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–±—â—É—é —Å—É–º–º—É –ø—Ä–æ–¥–∞–∂ –Ω–∞—Ä–∞—Å—Ç–∞—é—â–∏–º –∏—Ç–æ–≥–æ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞, –æ—Å–Ω–æ–≤–∞–Ω–Ω—É—é –Ω–∞ –¥–∞—Ç–∞—Ö –∑–∞–∫–∞–∑–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É—è `orderid` –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –≤–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø—ã –¥–∞—Ç).

```sql
SELECT custid, orderid, orderdate, val,
       val * 100.0 /
       SUM(val) OVER (PARTITION BY custid) AS percoftotalcust,
       SUM(val) OVER (PARTITION BY custid ORDER BY orderdate, orderid) AS runval
FROM Sales.OrderValues;
```

2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –≤ —Ñ–∞–π–ª–µ `D:\Labfiles\Lab13\Solution\73 - Lab Exercise 3 - Task 2 Result.txt`.

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 3: –ê–Ω–∞–ª–∏–∑ –æ–±—â–µ–π —Å—É–º–º—ã –ø—Ä–æ–¥–∞–∂ –Ω–∞—Ä–∞—Å—Ç–∞—é—â–∏–º –∏—Ç–æ–≥–æ–º –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –æ–±—ä–µ–º–∞ –ø—Ä–æ–¥–∞–∂ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∏ –º–µ—Å—è—Ü–∞
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ CTE `SalesMonth2007` –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è –≤—Ç–æ—Ä–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è. –ù–∞–ø–∏—à–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ `monthno` –∏ `val`. –î–æ–±–∞–≤—å—Ç–µ –¥–≤–∞ —Ä–∞—Å—á–µ—Ç–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–∞:
- `avglast3months`: —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—ä–µ–º–∞ –ø—Ä–æ–¥–∞–∂ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∏ –º–µ—Å—è—Ü–∞ –ø–µ—Ä–µ–¥ —Ç–µ–∫—É—â–∏–º –º–µ—Å—è—Ü–µ–º, –∏—Å–ø–æ–ª—å–∑—É—è –æ–∫–æ–Ω–Ω—É—é –∞–≥—Ä–µ–≥–∞—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é. –ü—Ä–∏–º–∏—Ç–µ –¥–æ–ø—É—â–µ–Ω–∏–µ, —á—Ç–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –º–µ—Å—è—Ü–µ–≤ –Ω–µ—Ç.
- `ytdval`: –∫—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂ –Ω–∞—Ä–∞—Å—Ç–∞—é—â–∏–º –∏—Ç–æ–≥–æ–º –¥–æ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞.

```sql
WITH SalesMonth2007 AS (
    SELECT MONTH(orderdate) AS monthno, SUM(val) AS val
    FROM Sales.OrderValues
    WHERE YEAR(orderdate) = 2007
    GROUP BY MONTH(orderdate)
)
SELECT monthno, val,
       AVG(LAG(val, 1) OVER (ORDER BY monthno)) +
       AVG(LAG(val, 2) OVER (ORDER BY monthno)) +
       AVG(LAG(val, 3) OVER (ORDER BY monthno)) / 3 AS avglast3months,
       SUM(val) OVER (ORDER BY monthno ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ytdval
FROM SalesMonth2007;
```

2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –≤ —Ñ–∞–π–ª–µ `D:\Labfiles\Lab13\Solution\74 - Lab Exercise 3 - Task 3 Result.txt`.

3. –ó–∞–∫—Ä–æ–π—Ç–µ SQL Server Management Studio, –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—è –Ω–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.


# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞: –†–∞–±–æ—Ç–∞ —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º PIVOT –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π

## üìå –°—Ü–µ–Ω–∞—Ä–∏–π
–í–∞—à–µ–º—É –≤–Ω–∏–º–∞–Ω–∏—é –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ —Å–∏—Ç—É–∞—Ü–∏—è, –≤ –∫–æ—Ç–æ—Ä–æ–π –æ—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω—É—é —Ç–∞–±–ª–∏—Ü—É (crosstab), –æ—Ç–æ–±—Ä–∞–∂–∞—é—â—É—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–º –≥—Ä—É–ø–ø–∞–º –∏ —Å—Ç—Ä–∞–Ω–∞–º. –ö–∞–∂–¥–∞—è –≥—Ä—É–ø–ø–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å—Ç–æ–ª–±—Ü–æ–º. –ò—Å–ø–æ–ª—å–∑—É—è –æ–ø–µ—Ä–∞—Ç–æ—Ä PIVOT, –≤—ã —Å–æ–∑–¥–∞–¥–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –æ—Ç—á—ë—Ç—ã.

## üòä –í–∞—à–∏ –∑–∞–¥–∞—á–∏:
1. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—É—é —Å—Ä–µ–¥—É.
2. –ü–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø–µ –∫–ª–∏–µ–Ω—Ç–æ–≤.
3. –£–∑–Ω–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É —Ä–∞–∑–Ω–æ–≥–æ —á–∏—Å–ª–∞ –∑–∞–ø–∏—Å–µ–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≥—Ä—É–ø–ø–∏—Ä—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞.
4. –†–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤—ã—Ä–∞–∂–µ–Ω–∏–π CTE –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–æ–∫.
5. –ù–∞—É—á–∏—Ç—å—Å—è –ø–æ–ª—É—á–∞—Ç—å –æ–±—â–∏–µ –æ–±—ä–µ–º—ã –ø—Ä–æ–¥–∞–∂ –ø–æ –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É –∏ —Ç–æ–≤–∞—Ä–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

---

## üí® –•–æ–¥ —Ä–∞–±–æ—Ç—ã

### ‚úÖ –ó–∞–¥–∞—á–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Å—Ä–µ–¥—ã
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã 20761C-MIA-DC –∏ 20761C-MIA-SQL –∑–∞–ø—É—â–µ–Ω—ã, –∑–∞—Ç–µ–º –∑–∞–π–¥–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä 20761C-MIA-SQL –ø–æ–¥ —É—á—ë—Ç–Ω–æ–π –∑–∞–ø–∏—Å—å—é ADVENTUREWORKS\Student —Å –ø–∞—Ä–æ–ª–µ–º Pa55w.rd.

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª `Setup.cmd` –≤ –ø–∞–ø–∫–µ `D:\Labfiles\Lab14\Starter` –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –≥—Ä—É–ø–ø–∞—Ö
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç-—Ñ–∞–π–ª `D:\Labfiles\Lab14\Starter\Project\Project.ssmssln` –∏ —Å–∫—Ä–∏–ø—Ç T-SQL `51 - Lab Exercise 1.sql`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö TSQL.

2. –ò–¢-–æ—Ç–¥–µ–ª –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª –≤–∞–º T-SQL-–∫–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è `Sales.CustGroups`, –∫–æ—Ç–æ—Ä–æ–µ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö: –∏—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (`custid`), —Å—Ç—Ä–∞–Ω–∞ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è (`country`) –∏ –ø—Ä–∏—Å–≤–æ–µ–Ω–Ω–∞—è –≥—Ä—É–ø–ø–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ (`custgroup`). –ì—Ä—É–ø–ø–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º: –∫–ª–∏–µ–Ω—Ç—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –ø–æ —Ç—Ä—ë–º –≥—Ä—É–ø–ø–∞–º ('A', 'B', 'C'):

```sql
CREATE VIEW Sales.CustGroups AS
SELECT
    custid,
    CHOOSE(custid % 3 + 1, N'A', N'B', N'C') AS custgroup,
    country
FROM Sales.Customers;
```

3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä CREATE VIEW.

4. –ù–∞–ø–∏—à–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤–Ω–æ–≤—å —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è `Sales.CustGroups`:

```sql
SELECT custid, custgroup, country
FROM Sales.CustGroups;
```

5. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å —ç—Ç–∞–ª–æ–Ω–Ω—ã–º, –Ω–∞—Ö–æ–¥—è—â–∏–º—Å—è –≤ —Ñ–∞–π–ª–µ `D:\Labfiles\Lab14\Solution\52 - Lab Exercise 1 - Task 1_1 Result.txt`.

6. –î–∞–ª–µ–µ –º–æ–¥–µ—Ä–Ω–∏–∑–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å, –ø—Ä–∏–º–µ–Ω–∏–≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä PIVOT, —á—Ç–æ–±—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∂–¥—É—é –≥—Ä—É–ø–ø—É –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å—Ç–æ–ª–±—Ü–µ. –ú—ã —Ö–æ—Ç–∏–º –≤—ã–≤–µ—Å—Ç–∏ —Ç—Ä–∏ —Å—Ç–æ–ª–±—Ü–∞ (–¥–ª—è –≥—Ä—É–ø–ø A, B –∏ C), –æ—Ç–æ–±—Ä–∞–∂–∞—é—â–∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø–µ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º:

```sql
SELECT country, [A], [B], [C]
FROM (
    SELECT country, custgroup
    FROM Sales.CustGroups
) AS src
PIVOT (
    COUNT(custgroup)
    FOR custgroup IN ([A], [B], [C])
) AS pivot_table;
```

7. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å —ç—Ç–∞–ª–æ–Ω–Ω—ã–º, –∏–º–µ—é—â–∏–º—Å—è –≤ —Ñ–∞–π–ª–µ `D:\Labfiles\Lab14\53 - Lab Exercise 1 - Task 1_2 Result.txt`.

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ PIVOT
1. –ò–¢-–æ—Ç–¥–µ–ª –¥–æ–±–∞–≤–∏–ª –≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ `Sales.CustGroups` –¥–≤–∞ –Ω–æ–≤—ã—Ö —Å—Ç–æ–ª–±—Ü–∞: –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ (`city`) –∏ –∏–º—è –∫–æ–Ω—Ç–∞–∫—Ç–∞ (`contactname`). –í—ã–ø–æ–ª–Ω–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è:

```sql
ALTER VIEW Sales.CustGroups AS
SELECT
    custid,
    CHOOSE(custid % 3 + 1, N'A', N'B', N'C') AS custgroup,
    country,
    city,
    contactname
FROM Sales.Customers;
```

2. –û–±–Ω–æ–≤–∏—Ç–µ —Å–≤–æ—é –≤–µ—Ä—Å–∏—é –∑–∞–ø—Ä–æ—Å–∞ –∏–∑ –∑–∞–¥–∞—á–∏ 1, –¥–æ–±–∞–≤–∏–≤ –Ω–æ–≤—ã–µ —Å—Ç–æ–ª–±—Ü—ã:

```sql
SELECT custid, custgroup, country, city, contactname
FROM Sales.CustGroups;
```

3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å —ç—Ç–∞–ª–æ–Ω–Ω—ã–º, –¥–æ—Å—Ç—É–ø–Ω—ã–º –≤ —Ñ–∞–π–ª–µ `D:\Labfiles\Lab14\54 - Lab Exercise 1 - Task 2 Result.txt`.

4. –ü–æ—á–µ–º—É —á–∏—Å–ª–æ —Å—Ç—Ä–æ–∫ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –¥–∞–∂–µ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ –≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ? –ü—Ä–∏—á–∏–Ω–∞ –∫—Ä–æ–µ—Ç—Å—è –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É—Å–ª–æ–≤–∏—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–µ PIVOT. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º—Å—è –ø–æ–¥—Ä–æ–±–Ω–µ–µ!

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CTE –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
1. –°–æ–∑–¥–∞–π—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ CTE (Common Table Expression) –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º `PivotCustGroups`, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã–±–µ—Ä–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è `Sales.CustGroups`, –∏ –∑–∞—Ç–µ–º –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä PIVOT, —á—Ç–æ–±—ã –¥–æ–±–∏—Ç—å—Å—è –Ω—É–∂–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:

```sql
WITH PivotCustGroups AS (
    SELECT custid, country, custgroup
    FROM Sales.CustGroups
)
SELECT country, [A], [B], [C]
FROM PivotCustGroups
PIVOT (
    COUNT(custgroup)
    FOR custgroup IN ([A], [B], [C])
) AS pivot_result;
```

2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å —ç—Ç–∞–ª–æ–Ω–Ω—ã–º, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–º –≤ —Ñ–∞–π–ª–µ `D:\Labfiles\Lab14\55 - Lab Exercise 1 - Task 3 Result.txt`.

3. –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–∞–∫–∏–º –∂–µ, –∫–∞–∫ –∏ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º –∑–∞–ø—Ä–æ—Å–µ –∏–∑ –∑–∞–¥–∞—á–∏ 1? –ü–æ—á–µ–º—É?

4. –í —á–µ–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CTE –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ PIVOT?

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 5: –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –æ–±—ä–µ–º–∞ –ø—Ä–æ–¥–∞–∂ –ø–æ –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É –∏ —Ç–æ–≤–∞—Ä–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
1. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –≤—ã–≤–µ–¥–∏—Ç–µ –æ–±—â—É—é —Å—É–º–º—É –ø—Ä–æ–¥–∞–∂ –ø–æ –≤—Å–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ç–æ–≤–∞—Ä–æ–≤, –ø–æ–∫–∞–∑—ã–≤–∞—è –∫–∞–∂–¥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å—Ç–æ–ª–±—Ü–µ. –í–æ—Ç –∫–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å:

- –°–æ–∑–¥–∞–π—Ç–µ CTE –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º `SalesByCategory`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–±–∏—Ä–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞ (`custid`), –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (`categoryname`) –∏ –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂ (`totalsales`) –ø–æ –∑–∞–∫–∞–∑—É. –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –≤—ã–±—Ä–∞–Ω—ã –∑–∞ 2008 –≥–æ–¥.

```sql
WITH SalesByCategory AS (
    SELECT
        o.custid,
        p.categoryname,
        SUM(od.qty * od.unitprice) AS totalsales
    FROM Sales.Orders AS o
    INNER JOIN Sales.OrderDetails AS od ON o.orderid = od.orderid
    INNER JOIN Production.Products AS prod ON od.productid = prod.productid
    INNER JOIN Production.Categories AS p ON prod.categoryid = p.categoryid
    WHERE YEAR(o.orderdate) = 2008
    GROUP BY o.custid, p.categoryname
)
SELECT custid, [Beverages], [Condiments], [Confections], [Dairy Products], [Grains/Cereals], [Meat/Poultry], [Produce], [Seafood]
FROM SalesByCategory
PIVOT (
    SUM(totalsales)
    FOR categoryname IN ([Beverages], [Condiments], [Confections], [Dairy Products], [Grains/Cereals], [Meat/Poultry], [Produce], [Seafood])
) AS pivot_sales;
```

2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–Ω—ã–π T-SQL-–∫–æ–¥ (–≤–∫–ª—é—á–∞—è —Å–æ–∑–¥–∞–Ω–∏–µ CTE –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä SELECT).

3. –°—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å —ç—Ç–∞–ª–æ–Ω–Ω—ã–º, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–º –≤ —Ñ–∞–π–ª–µ `D:\Labfiles\Lab14\56 - Lab Exercise 1 - Task 4 Result.txt`.

---

üöÄ –ó–∞–≤–µ—Ä—à–∏–≤ —ç—Ç—É –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—É—é —Ä–∞–±–æ—Ç—É, –≤—ã –æ—Å–≤–æ–∏—Ç–µ —Ä–∞–±–æ—Ç—É —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º PIVOT –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ SQL Server.
